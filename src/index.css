@import 'tailwindcss';
@import "tw-animate-css";

@layer base {
  body {
    font-family: 'Inter', sans-serif;
    overflow-x: hidden; /* Prevent horizontal scroll */
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  * {
    @apply border-border
  }

  /* Prevent iOS Safari zoom on input focus */
  input, select, textarea {
    font-size: 16px !important;
  }
  
  /* Ensure touch targets are large enough on mobile */
  @media (max-width: 768px) {
    input, select, textarea, button {
      font-size: 16px !important;
    }
  }

  /* Force Sonner toasts to use neumorphic theme */
  [data-sonner-toast] {
    background-color: oklch(0.94 0.008 220) !important; /* Same as --background */
    border: none !important;
  }

  .dark [data-sonner-toast] {
    background-color: oklch(0.145 0 0) !important; /* Dark mode background */
  }

  [data-sonner-toast] [data-title] {
    color: oklch(0.3 0.02 220) !important; /* Dark grey for better contrast */
    font-weight: 600 !important;
  }

  [data-sonner-toast] [data-description] {
    color: oklch(0.4 0.02 220) !important; /* Medium grey for readability */
  }

  [data-sonner-toast] [data-close-button] {
    background-color: oklch(0.9 0.008 220) !important; /* Slightly darker grey */
    border: none !important;
    color: oklch(0.3 0.02 220) !important; /* Dark grey for visibility */
    opacity: 1 !important;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
  }

  [data-sonner-toast] [data-close-button]:hover {
    background-color: oklch(0.85 0.008 220) !important;
    color: oklch(0.2 0.02 220) !important; /* Even darker on hover */
  }

  [data-sonner-toast] [data-close-button]:hover {
    background-color: #f3f4f6 !important;
  }

  /* Dark mode toast styling - SCOPED to .dashboard-dark */
  .dashboard-dark [data-sonner-toast] {
    background-color: oklch(0.145 0 0) !important;
  }

  .dashboard-dark [data-sonner-toast] [data-close-button]:hover {
    background-color: oklch(0.20 0.006 220) !important;
  }

  /* Blog content images - prevent zooming and add rounded corners */
  .prose img {
    object-fit: contain !important;
    max-height: 500px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    background-color: #f9fafb !important;
    border-radius: 0.75rem !important; /* 12px rounded */
  }

  /* Dark mode blog images - SCOPED to .dashboard-dark */
  .dashboard-dark .prose img {
    background-color: oklch(0.18 0.006 220) !important;
  }

  /* TipTap editor dark mode - SCOPED to .dashboard-dark */
  .dashboard-dark .ProseMirror {
    color: var(--foreground);
  }

  .dashboard-dark .ProseMirror p.is-editor-empty:first-child::before {
    color: var(--muted-foreground);
  }

  .dashboard-dark .tiptap {
    color: var(--foreground);
  }

  /* Radix UI dark mode - SCOPED to .dashboard-dark */
  .dashboard-dark [data-radix-popper-content-wrapper] {
    background-color: oklch(0.27 0.005 250) !important;
    border-color: oklch(0.35 0.010 250) !important;
  }

  /* Radix Portal elements (modals, dialogs, popovers, dropdowns) */
  .dashboard-dark [data-radix-portal] {
    color: oklch(0.95 0.005 250) !important;
  }

  /* All Radix popper content */
  .dashboard-dark [data-radix-popper-content-wrapper] > *,
  .dashboard-dark [data-radix-dropdown-menu-content],
  .dashboard-dark [data-radix-popover-content],
  .dashboard-dark [data-radix-dialog-content] {
    background-color: oklch(0.27 0.005 250) !important;
    border-color: oklch(0.35 0.010 250) !important;
    color: oklch(0.95 0.005 250) !important;
  }

  /* Hide reCAPTCHA v3 badge (Google allows this with proper disclosure) */
  .grecaptcha-badge {
    visibility: hidden !important;
    opacity: 0 !important;
  }
}

@layer utilities {
  /* Neumorphic design utilities */
  .neomorph-raised {
    box-shadow: 
      8px 8px 16px var(--shadow-dark),
      -8px -8px 16px var(--shadow-light);
  }
  
  .neomorph-inset {
    box-shadow: 
      inset 4px 4px 8px var(--shadow-dark),
      inset -4px -4px 8px var(--shadow-light);
  }
  
  .neomorph-flat {
    box-shadow: 
      4px 4px 8px var(--shadow-dark),
      -4px -4px 8px var(--shadow-light);
  }
  
  .neomorph-button {
    box-shadow: 
      6px 6px 12px var(--shadow-dark),
      -6px -6px 12px var(--shadow-light);
    transition: all 0.2s ease;
  }
  
  .neomorph-button:hover {
    box-shadow: 
      4px 4px 8px var(--shadow-dark),
      -4px -4px 8px var(--shadow-light);
  }
  
  .neomorph-hover {
    transition: all 0.2s ease;
  }
  
  .neomorph-hover:hover {
    box-shadow: 
      6px 6px 12px var(--shadow-dark),
      -6px -6px 12px var(--shadow-light);
  }
  
    .neomorph-pressed {
    box-shadow: 
      inset 3px 3px 6px var(--shadow-dark),
      inset -3px -3px 6px var(--shadow-light);
  }

  /* Hide scrollbar but keep functionality */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari and Opera */
  }
  
  /* Enhanced touch and drag interactions */
  .touch-manipulation {
    touch-action: manipulation;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
  
  /* Improved drag handle visibility */
  .drag-handle {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Custom scrollbar for chapter list */
  .chapter-list::-webkit-scrollbar {
    width: 6px;
  }
  
  .chapter-list::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .chapter-list::-webkit-scrollbar-thumb {
    background: hsl(var(--muted-foreground) / 0.3);
    border-radius: 3px;
  }
  
  .chapter-list::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--muted-foreground) / 0.5);
  }
  
  .neomorph-button:active {
    box-shadow: 
      inset 2px 2px 4px var(--shadow-dark),
      inset -2px -2px 4px var(--shadow-light);
  }

  /* Mobile-specific adjustments */
  @media (max-width: 1024px) {
    /* Enable momentum scrolling on iOS */
    * {
      -webkit-overflow-scrolling: touch;
    }
    
    /* iOS scrolling fix */
    .ios-scroll {
      -webkit-overflow-scrolling: touch;
      overflow: auto;
    }
    
    .neomorph-raised {
      box-shadow: 
        6px 6px 12px var(--shadow-dark),
        -6px -6px 12px var(--shadow-light);
    }
    
    .neomorph-inset {
      box-shadow: 
        inset 3px 3px 6px var(--shadow-dark),
        inset -3px -3px 6px var(--shadow-light);
    }
    
    .neomorph-flat {
      box-shadow: 
        3px 3px 6px var(--shadow-dark),
        -3px -3px 6px var(--shadow-light);
    }
    
    .neomorph-button {
      box-shadow: 
        4px 4px 8px var(--shadow-dark),
        -4px -4px 8px var(--shadow-light);
    }
    
    .neomorph-button:hover {
      box-shadow: 
        3px 3px 6px var(--shadow-dark),
        -3px -3px 6px var(--shadow-light);
    }
    
    .neomorph-button:active {
      box-shadow: 
        inset 2px 2px 4px var(--shadow-dark),
        inset -2px -2px 4px var(--shadow-light);
    }
  }

  /* Line clamp utilities */
  .line-clamp-1 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
    line-clamp: 1;
  }
  
  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    line-clamp: 2;
  }
}

:root {
  /*
   * Base colors that define the core visual identity - Neumorphic theme
   * --background: Main page background with subtle warm gray
   * --foreground: Primary text color to use on the background
   */
  --background: oklch(0.94 0.008 220);
  --foreground: oklch(0.20 0.02 220);

  --card: oklch(0.94 0.008 220);
  --card-foreground: oklch(0.20 0.02 220);
  --popover: oklch(0.95 0.008 220);
  --popover-foreground: oklch(0.20 0.02 220);

  /*
   * Action colors that represent interactive elements
   * --primary: Modern purple gradient feel
   * --secondary: Soft elevated feel
   * --accent: Vibrant accent for highlights
   * --destructive: Gentle red for warnings
   */
  --primary: oklch(0.55 0.20 280);
  --primary-foreground: oklch(0.98 0.005 280);
  --secondary: oklch(0.94 0.008 220);
  --secondary-foreground: oklch(0.25 0.02 220);
  --accent: oklch(0.70 0.18 340);
  --accent-foreground: oklch(0.98 0.005 340);
  --destructive: oklch(0.60 0.15 20);
  --destructive-foreground: oklch(0.98 0.005 20);

  /*
   * Supporting UI colors for neumorphic design
   * --muted: Slightly darker for recessed areas
   * --border: Subtle borders for definition
   * --input: Input field styling
   * --ring: Focus indicator with primary color
   */
  --muted: oklch(0.92 0.008 220);
  --muted-foreground: oklch(0.50 0.02 220);
  --border: oklch(0.88 0.008 220);
  --input: oklch(0.96 0.008 220);
  --ring: oklch(0.55 0.20 280);

  /*
   * Neumorphic shadow variables for elevated/inset effects
   */
  --shadow-light: oklch(0.98 0.005 220);
  --shadow-dark: oklch(0.85 0.015 220);

  /*
   * Border radius for modern, soft feel
   */
  --radius: 1rem;
}

/*
 * Dark mode theme - SCOPED to dashboard with .dashboard-dark class
 * Landing pages and marketing pages remain unaffected
 * Using proper dark neumorphic design principles
 */
.dashboard-dark {
  /* Force all text to use proper foreground color */
  color: oklch(0.95 0.005 250);
  
  /* Dark neumorphic base - soft dark gray, not pure black */
  --background: oklch(0.25 0.005 250);
  --foreground: oklch(0.95 0.005 250);

  /* Cards slightly lighter than background for subtle elevation */
  --card: oklch(0.27 0.005 250);
  --card-foreground: oklch(0.95 0.005 250);
  --popover: oklch(0.27 0.005 250);
  --popover-foreground: oklch(0.95 0.005 250);

  /* Primary color - brighter and more saturated for visibility */
  --primary: oklch(0.70 0.24 280);
  --primary-foreground: oklch(0.98 0.005 280);
  --secondary: oklch(0.30 0.008 250);
  --secondary-foreground: oklch(0.92 0.008 250);
  --accent: oklch(0.75 0.20 340);
  --accent-foreground: oklch(0.98 0.005 340);
  --destructive: oklch(0.70 0.18 20);
  --destructive-foreground: oklch(0.98 0.005 20);

  /* Muted elements - brighter for better text visibility */
  --muted: oklch(0.30 0.008 250);
  --muted-foreground: oklch(0.75 0.008 250);
  --border: oklch(0.35 0.010 250);
  --input: oklch(0.28 0.008 250);
  --ring: oklch(0.70 0.24 280);

  /* Neumorphic shadows - subtle, close to base colors */
  --shadow-light: oklch(0.32 0.008 250);
  --shadow-dark: oklch(0.18 0.012 250);

  /* Also update the theme colors that Tailwind uses */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-shadow-light: var(--shadow-light);
  --color-shadow-dark: var(--shadow-dark);
}

/* Force all text elements inside dark mode to be white */
.dashboard-dark h1,
.dashboard-dark h2,
.dashboard-dark h3,
.dashboard-dark h4,
.dashboard-dark h5,
.dashboard-dark h6,
.dashboard-dark p,
.dashboard-dark span,
.dashboard-dark div,
.dashboard-dark button,
.dashboard-dark label {
  color: inherit;
}

/* Input fields in dark mode */
.dashboard-dark input,
.dashboard-dark textarea,
.dashboard-dark select {
  background-color: oklch(0.28 0.008 250) !important;
  color: oklch(0.95 0.005 250) !important;
  border-color: oklch(0.35 0.010 250) !important;
}

.dashboard-dark input::placeholder,
.dashboard-dark textarea::placeholder {
  color: oklch(0.65 0.008 250) !important;
}

/* Badges and tags - dark background with light text */
.dashboard-dark [class*="badge"],
.dashboard-dark .badge {
  background-color: oklch(0.30 0.015 280) !important;
  color: oklch(0.95 0.005 250) !important;
}

/* Category tags in snippets - dark mode versions */
.dashboard-dark .bg-blue-100 {
  background-color: oklch(0.35 0.08 250) !important;
}
.dashboard-dark .text-blue-800 {
  color: oklch(0.90 0.08 250) !important;
}
.dashboard-dark .bg-purple-100 {
  background-color: oklch(0.35 0.08 300) !important;
}
.dashboard-dark .text-purple-800 {
  color: oklch(0.90 0.08 300) !important;
}
.dashboard-dark .bg-green-100 {
  background-color: oklch(0.35 0.08 150) !important;
}
.dashboard-dark .text-green-800 {
  color: oklch(0.90 0.08 150) !important;
}
.dashboard-dark .bg-yellow-100 {
  background-color: oklch(0.35 0.08 90) !important;
}
.dashboard-dark .text-yellow-800 {
  color: oklch(0.90 0.08 90) !important;
}
.dashboard-dark .bg-pink-100 {
  background-color: oklch(0.35 0.08 350) !important;
}
.dashboard-dark .text-pink-800 {
  color: oklch(0.90 0.08 350) !important;
}
.dashboard-dark .bg-indigo-100 {
  background-color: oklch(0.35 0.08 270) !important;
}
.dashboard-dark .text-indigo-800 {
  color: oklch(0.90 0.08 270) !important;
}
.dashboard-dark .bg-gray-100 {
  background-color: oklch(0.35 0.01 250) !important;
}
.dashboard-dark .text-gray-800 {
  color: oklch(0.90 0.01 250) !important;
}

/* Dialogs and modals in dark mode - use :has() to detect if dashboard-dark exists */
body:has(.dashboard-dark) [role="dialog"],
body:has(.dashboard-dark) [data-radix-dialog-content],
body:has(.dashboard-dark) [data-slot="dialog-content"] {
  background-color: oklch(0.27 0.005 250) !important;
  border-color: oklch(0.35 0.010 250) !important;
  color: oklch(0.95 0.005 250) !important;
}

/* Dialog overlay in dark mode - darker background */
body:has(.dashboard-dark) [data-radix-dialog-overlay],
body:has(.dashboard-dark) [data-slot="dialog-overlay"] {
  background-color: rgba(0, 0, 0, 0.7) !important;
}

/* Dropdown menus in dark mode - these are portaled outside the component tree */
body:has(.dashboard-dark) [data-radix-popper-content-wrapper],
body:has(.dashboard-dark) [data-radix-dropdown-menu-content],
body:has(.dashboard-dark) [data-radix-popover-content],
body:has(.dashboard-dark) [role="menu"],
body:has(.dashboard-dark) [data-slot="dropdown-menu-content"],
body:has(.dashboard-dark) [data-slot="popover-content"] {
  background-color: oklch(0.27 0.005 250) !important;
  border-color: oklch(0.35 0.010 250) !important;
  color: oklch(0.95 0.005 250) !important;
}

/*
 * Map the CSS variables to Tailwind's theme system
```
 * This enables using classes like bg-primary, text-foreground, etc.
 */
@theme {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);

  /* Neumorphic shadow colors */
  --color-shadow-light: var(--shadow-light);
  --color-shadow-dark: var(--shadow-dark);

  /* Map radius variables to create a consistent rounding system */
  --radius-sm: calc(var(--radius) * 0.5);
  --radius-md: var(--radius);
  --radius-lg: calc(var(--radius) * 1.5);
  --radius-xl: calc(var(--radius) * 2);
  --radius-2xl: calc(var(--radius) * 3);
  --radius-full: 9999px;
}

/* Tiptap Editor Styles */
.ProseMirror {
  outline: none;
  min-height: 200px;
  padding: 1rem;
}

.ProseMirror p.is-editor-empty:first-child::before {
  color: hsl(var(--muted-foreground));
  content: attr(data-placeholder);
  float: left;
  height: 0;
  pointer-events: none;
}

.ProseMirror h1 {
  font-size: 2em;
  font-weight: bold;
  margin-top: 0.67em;
  margin-bottom: 0.67em;
}

.ProseMirror h2 {
  font-size: 1.5em;
  font-weight: bold;
  margin-top: 0.83em;
  margin-bottom: 0.83em;
}

.ProseMirror h3 {
  font-size: 1.17em;
  font-weight: bold;
  margin-top: 1em;
  margin-bottom: 1em;
}

.ProseMirror p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  line-height: 1.6;
}

.ProseMirror ul,
.ProseMirror ol {
  padding-left: 2em;
  margin: 0.5em 0;
}

.ProseMirror li {
  margin: 0.25em 0;
}

.ProseMirror strong {
  font-weight: bold;
}

.ProseMirror em {
  font-style: italic;
}

.ProseMirror u {
  text-decoration: underline;
}

.ProseMirror code {
  background-color: hsl(var(--muted));
  padding: 0.2em 0.4em;
  border-radius: 3px;
  font-family: monospace;
  font-size: 0.9em;
}

.ProseMirror pre {
  background-color: hsl(var(--muted));
  padding: 1em;
  border-radius: 6px;
  overflow-x: auto;
}

.ProseMirror blockquote {
  border-left: 3px solid hsl(var(--border));
  padding-left: 1em;
  margin-left: 0;
  font-style: italic;
  color: hsl(var(--muted-foreground));
}

/* Preview tab prose styling */
.prose {
  color: hsl(var(--foreground));
  max-width: 65ch;
}

.prose p {
  margin-bottom: 1.25em;
  line-height: 1.75;
}

.prose h1 {
  font-size: 2.25em;
  font-weight: 800;
  line-height: 1.1111;
  margin-top: 0;
  margin-bottom: 0.8888em;
}

.prose h2 {
  font-size: 1.5em;
  font-weight: 700;
  line-height: 1.3333;
  margin-top: 2em;
  margin-bottom: 1em;
}

.prose h3 {
  font-size: 1.25em;
  font-weight: 600;
  line-height: 1.6;
  margin-top: 1.6em;
  margin-bottom: 0.6em;
}

.prose strong {
  font-weight: 600;
  color: hsl(var(--foreground));
}

.prose em {
  font-style: italic;
}

.prose u {
  text-decoration: underline;
}

.prose ul, .prose ol {
  padding-left: 1.625em;
  margin-top: 1.25em;
  margin-bottom: 1.25em;
}

.prose li {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.prose ul > li {
  padding-left: 0.375em;
}

.prose ol > li {
  padding-left: 0.375em;
}

/* Text alignment support */
.prose [style*="text-align: center"] {
  text-align: center;
}

.prose [style*="text-align: right"] {
  text-align: right;
}

.prose [style*="text-align: justify"] {
  text-align: justify;
}
